<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Поиск по вопросам</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #searchBox { width: 100%; padding: 10px; font-size: 16px; }
    .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; }
    #status { margin-bottom: 15px; font-weight: bold; }
    .correct { background-color: lightgreen; font-weight: bold; }
    .highlight { background-color: yellow; font-weight: bold; }
</style>
</head>
<body>

<h2>Поиск по вопросам</h2>
<div id="status">Загрузка данных...</div>
<input type="text" id="searchBox" placeholder="Введите слово или фразу...">
<div id="results"></div>

<script>
let questions = [];

function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Загружаем текст
fetch('document.txt')
    .then(res => res.text())
    .then(data => {
        document.getElementById('status').textContent = "Данные загружены. Можно искать.";
        // Объединяем переносы строк внутри вопросов, чтобы поиск работал корректно
        questions = data.split(/\n\s*\n/).map(q => q.replace(/\s+/g, ' ').trim()).filter(q => q.length > 0);
    })
    .catch(err => {
        document.getElementById('status').textContent = "Ошибка: " + err.message;
    });

document.getElementById('searchBox').addEventListener('input', function () {
    const queryRaw = this.value.trim();
    const query = queryRaw.toLowerCase();
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = "";

    if (!questions.length || query.length < 2) return;

    const match = questions.find(q => q.toLowerCase().includes(query));

    if (!match) {
        resultsDiv.innerHTML = "<p>Ничего не найдено.</p>";
        return;
    }

    // Подсветка правильного ответа (+) и текста поиска
    let formatted = match.replace(/\(\+\)/g, '<span class="correct">(+)</span>');
    const regex = new RegExp(escapeRegExp(queryRaw), "gi");
    formatted = formatted.replace(regex, m => `<span class="highlight">${m}</span>`);

    const div = document.createElement('div');
    div.classList.add('result');
    div.innerHTML = formatted + '<br><button onclick="window.open(\'document.pdf\')">Открыть PDF</button>';
    resultsDiv.appendChild(div);

    setTimeout(() => {
        div.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
});
</script>

</body>
</html>