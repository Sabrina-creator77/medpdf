<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>PDF Viewer + Поиск — Лечебное дело</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    header { padding:10px 16px; background:#0b6; color:#003; display:flex; gap:12px; align-items:center; }
    header h1 { font-size:18px; margin:0; }
    #controls { margin-left:auto; display:flex; gap:8px; align-items:center; }
    #viewerContainer { height: calc(100vh - 60px); overflow:auto; background:#666; padding:10px; }
    .page { margin: 8px auto; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.5); position:relative; }
    canvas { display:block; }
    .pageNumber { position:absolute; right:6px; top:6px; background:rgba(255,255,255,0.9); padding:4px 6px; border-radius:4px; font-size:12px; }
    input[type="text"] { padding:6px; font-size:14px; width:260px; }
    button { padding:6px 10px; font-size:14px; }
  </style>
</head>
<body>
  <header>
    <h1>Документ — "Лечебное дело" (PDF)</h1>
    <div id="controls">
      <input id="query" type="text" placeholder="Введите слово или фразу для поиска">
      <button id="btnFind">Найти</button>
      <span id="status">Готово</span>
    </div>
  </header>

  <div id="viewerContainer" tabindex="0"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    const url = 'document.pdf';
    const container = document.getElementById('viewerContainer');
    const status = document.getElementById('status');
    const queryInput = document.getElementById('query');
    const btnFind = document.getElementById('btnFind');
    let pdfDoc = null;
    let pageText = [];

    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    function setStatus(t){ status.textContent = t; }

    async function loadPDF() {
      setStatus('Загрузка PDF...');
      pdfDoc = await pdfjsLib.getDocument(url).promise;
      setStatus('PDF загружен. Страниц: ' + pdfDoc.numPages);
      for(let p=1;p<=pdfDoc.numPages;p++){
        await renderPage(p);
      }
      setStatus('Готово. Введите запрос и нажмите "Найти".');
    }

    async function renderPage(pageNum){
      const page = await pdfDoc.getPage(pageNum);
      const viewport = page.getViewport({scale:1.5});
      const pageDiv = document.createElement('div');
      pageDiv.className = 'page';
      pageDiv.style.width = viewport.width + 'px';
      pageDiv.style.height = viewport.height + 'px';
      const canvas = document.createElement('canvas');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      const ctx = canvas.getContext('2d');
      pageDiv.appendChild(canvas);
      const pageNumberBadge = document.createElement('div');
      pageNumberBadge.className = 'pageNumber';
      pageNumberBadge.textContent = 'Страница ' + pageNum;
      pageDiv.appendChild(pageNumberBadge);
      container.appendChild(pageDiv);
      await page.render({canvasContext: ctx, viewport: viewport}).promise;
      const txt = await page.getTextContent();
      pageText[pageNum] = txt.items.map(i => i.str).join(' ');
    }

    function findAllPages(query){
      const q = query.trim().toLowerCase();
      if(!q) return [];
      const results = [];
      for(let p=1;p<pageText.length;p++){
        const t = (pageText[p]||'').toLowerCase();
        if(t.includes(q)){
          results.push({page: p});
        }
      }
      return results;
    }

    function scrollToPage(pagenum){
      const pages = container.getElementsByClassName('page');
      if(pagenum-1 < pages.length){
        pages[pagenum-1].scrollIntoView({behavior:'smooth', block:'center'});
      }
    }

    btnFind.addEventListener('click', () => {
      const res = findAllPages(queryInput.value);
      if(res.length===0){
        setStatus('Ничего не найдено');
      } else {
        setStatus('Найдено на ' + res.length + ' страницах, первая: ' + res[0].page);
        scrollToPage(res[0].page);
      }
    });

    loadPDF();
  </script>
</body>
</html>